{% extends "layout.html" %}
{% block body %}
<h1 class="{{page}}">{{_(title)}}</h1>

<div class="filterheader" style="text-align: right; margin-bottom: 20px;">
  <div class="dropdown" style="display: inline-block;">
    <button class="btn btn-default dropdown-toggle sort-dropdown-btn" type="button" id="sortMenu" data-toggle="dropdown"
      aria-haspopup="true" aria-expanded="true">
      <i class="fas fa-sort-amount-down" style="color: #ff7174;"></i> {{_('Sort By')}}
      <span class="caret" style="margin-left: 5px;"></span>
    </button>
    <ul class="dropdown-menu dropdown-menu-right sort-dropdown-menu" aria-labelledby="sortMenu">
      <li><a href="#" class="sort-btn" data-order="asc">{{_('Name: A to Z')}}</a></li>
      <li><a href="#" class="sort-btn" data-order="desc">{{_('Name: Z to A')}}</a></li>
    </ul>
  </div>
  {% if charlist|length %}
  <div class="btn-group character-filter" role="group" style="margin-left: 10px;">
    <button type="button" class="btn btn-default filter-btn active" data-char="all">{{_('All')}}</button>
    {% for char in charlist %}
    <button type="button" class="btn btn-default filter-btn" data-char="{{char[0]}}">{{char[0]}}</button>
    {% endfor %}
  </div>
  {% endif %}

  {% if data == "series" %}
  <button class="update-view btn btn-primary" data-target="series_view" id="grid-button"
    data-view="grid">{{_('Grid')}}</button>
  {% endif %}
</div>
<div class="data-display-container">
  <div class="category-grid" id="category-grid">
    {% set icons = ['fa-book', 'fa-book-open', 'fa-swatchbook', 'fa-atlas', 'fa-scroll', 'fa-bookmark', 'fa-pen-nib',
    'fa-feather-alt', 'fa-glasses', 'fa-theater-masks', 'fa-palette', 'fa-flask', 'fa-heart', 'fa-globe-americas',
    'fa-landmark', 'fa-music', 'fa-camera', 'fa-film'] %}
    {% for entry in entries %}
    {% set sort_name = '' %}
    {% if entry.name %}{% set sort_name = entry.name %}{% elif entry.format %}{% set sort_name = entry.format %}{% else
    %}{% set sort_name = entry[0].name %}{% endif %}
    <a href="{% if entry.format %}{{url_for('web.books_list', data=data, sort_param='stored', book_id=entry.format )}}{% else %}{{url_for('web.books_list', data=data, sort_param='stored', book_id=entry[0].id )}}{% endif %}"
      class="category-card" data-name="{{ sort_name }}">
      <div class="category-icon">
        <i class="fas {{ icons | random }}"></i>
      </div>
      <div class="category-name">
        {% if entry.name %}
        <div class="rating">
          {% for number in range(entry.name|int) %}
          <span class="glyphicon glyphicon-star good"></span>
          {% if loop.last and loop.index < 5 %} {% for numer in range(5 - loop.index) %} <span
            class="glyphicon glyphicon-star-empty"></span>
            {% endfor %}
            {% endif %}
            {% endfor %}
        </div>
        {% else %}
        {% if entry.format %}
        {{entry.format}}
        {% else %}
        {{entry[0].name}}
        {% endif %}
        {% endif %}
      </div>
      <div class="category-count">
        {{ entry[1] }} {{_('Books')}}
      </div>
    </a>
    {% endfor %}
  </div>
</div>
{% endblock %}
{% block js %}
<script>
  $(document).ready(function () {
    // Sorting Logic
    $('.sort-btn').click(function (e) {
      e.preventDefault();
      var order = $(this).data('order');
      var $grid = $('#category-grid');
      var $items = $grid.children('.category-card');

      $items.sort(function (a, b) {
        var nameA = $(a).data('name').toString().toUpperCase();
        var nameB = $(b).data('name').toString().toUpperCase();
        if (order === 'asc') {
          return (nameA < nameB) ? -1 : (nameA > nameB) ? 1 : 0;
        } else {
          return (nameA > nameB) ? -1 : (nameA < nameB) ? 1 : 0;
        }
      });

      $grid.append($items);
    });

    // Filtering Logic
    $('.filter-btn').click(function () {
      $('.filter-btn').removeClass('active');
      $(this).addClass('active');

      var char = $(this).data('char');
      var $items = $('.category-card');

      if (char === 'all') {
        $items.show();
      } else {
        $items.each(function () {
          var name = $(this).data('name').toString().toUpperCase();
          if (name.startsWith(char)) {
            $(this).show();
          } else {
            $(this).hide();
          }
        });
      }
    });
  });
</script>
{% endblock %}